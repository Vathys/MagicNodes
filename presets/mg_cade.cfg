# MagicNodes CADE 2.5 presets

[step1]
# seed: 0
# control_after_generate: fixed
# steps: 10
# cfg: 8.0
# denoise: 1.00
# sampler_name: ddim
# scheduler: MGHybrid
iterations: 2
steps_delta: -2.00
cfg_delta: 0.03
denoise_delta: 0.28

smart_seed_enable: true

# toggles
apply_sharpen: false
apply_upscale: true
apply_ids: true
clip_clean: true
latent_compare: true

# latent buffer (internal)
# latent_buffer: false
# lb_inject: 0.25
# lb_ema: 0.75
# lb_every: 1
# lb_anchor_every: 6
# lb_masked: true
# lb_rebase_thresh: 0.10
# lb_rebase_rate: 0.25

# detail controls
#ids_strength: 0.85
ids_strength: 1.45
upscale_method: lanczos
scale_by: 1.0
scale_delta: -0.15
noise_offset: 0.29
threshold: 1.0
#sharpness_strength: 0.075
sharpness_strength: 0.025
accumulation: fp16+fp16

# reference clean
reference_clean: true
reference_preview: 512
reference_threshold: 0.02
reference_cooldown: 2

# cfg schedule (internal)
#cfg_sched: off | cosine | warmup | u
# cfg_sched: warmup
# cfg_sched_min: 6.0
# cfg_sched_max: 8.8
# cfg_sched_gamma: 1.5
# cfg_sched_u_pow: 1.0


# guidance
guidance_mode: ZeResFDG
rescale_multiplier: 0.82
momentum_beta: 0.22
cfg_curve: 0.85
perp_damp: 0.80

# NAG
use_nag: true
nag_scale: 4.0
nag_tau: 2.5
nag_alpha: 0.25

# zero init
use_zero_init: false
zero_init_steps: 0

# FDG / ZE thresholds
#fdg_low: 0.25
fdg_low: 0.45
fdg_high: 0.7
fdg_sigma: 1.20
#ze_res_zero_steps: 10
ze_res_zero_steps: 11
ze_adaptive: true
ze_r_switch_low: 0.25
ze_r_switch_high: 0.85
fdg_low_adaptive: true
fdg_low_min: 0.45
fdg_low_max: 0.85
fdg_ema_beta: 0.45


# Mahiro+/Muse blend
muse_blend: true
muse_blend_strength: 0.29

# eps scale
eps_scale_enable: true
eps_scale: 0.0025

# CLIPSeg
clipseg_enable: false
# clipseg_text: hand, face
clipseg_preview: 512
clipseg_threshold: 0.30
clipseg_blur: 9.5
clipseg_dilate: 5
clipseg_gain: 0.6
clipseg_blend: fuse
clipseg_reference_gate: true
clipseg_reference_threshold: 0.005

# polish
polish_enable: false
polish_keep_low: 0.40
polish_edge_lock: 0.20
polish_sigma: 1.0
polish_start_after: 1
polish_keep_low_ramp: 0.20

# mid-frequency stabilizer (hands/objects scale)
midfreq_enable: true
midfreq_gain: 0.10
midfreq_sigma_low: 0.90
midfreq_sigma_high: 2.00

# QSilk-AQClip-Lite (adaptive latent clipping)
aqclip_enable: true
aq_tile: 32
aq_stride: 8
aq_alpha: 2.0
aq_attn: true
aq_ema_beta: 0.8

# KV pruning (self-attention speedup)
kv_prune_enable: false
kv_keep: 0.85
kv_min_tokens: 128

[step2]
# core
# seed: 0
# control_after_generate: fixed
# steps: 10
# cfg: 6.5
# denoise: 0.56
# sampler_name: ddim
# scheduler: MGHybrid
iterations: 2
steps_delta: 2.00
cfg_delta: 0.03
denoise_delta: 0.0500

# Smart seed toggle (disable for this step)
smart_seed_enable: false

# toggles
apply_sharpen: false
apply_upscale: true
apply_ids: true
clip_clean: true
latent_compare: true

# latent buffer (internal)
# latent_buffer: true
# lb_inject: 0.25
# lb_ema: 0.75
# lb_every: 1
# lb_anchor_every: 6
# lb_masked: true
# lb_rebase_thresh: 0.10
# lb_rebase_rate: 0.25

# detail controls
#ids_strength: 0.60
ids_strength: 1.25
upscale_method: lanczos
scale_by: 1.30
scale_delta: 0.15
noise_offset: 0.09
threshold: 1.000
sharpness_strength: 0.081
accumulation: fp16+fp16

# reference clean
reference_clean: true
reference_preview: 512
reference_threshold: 0.020
reference_cooldown: 2

# cfg schedule (internal)
#cfg_sched: off | cosine | warmup | u
# cfg_sched: warmup
# cfg_sched_min: 4.0
# cfg_sched_max: 6.5
# cfg_sched_gamma: 1.5
# cfg_sched_u_pow: 1.0


# guidance
guidance_mode: ZeResFDG
#rescale_multiplier: 0.75
rescale_multiplier: 0.75
momentum_beta: 0.15
cfg_curve: 0.85
perp_damp: 0.80

# NAG
use_nag: true
nag_scale: 4.0
nag_tau: 2.50
nag_alpha: 0.25

# zero init
use_zero_init: false
zero_init_steps: 0

# FDG / ZE thresholds
fdg_low: 0.35
fdg_high: 0.7
fdg_sigma: 1.10
ze_res_zero_steps: 12
ze_adaptive: true
ze_r_switch_high: 0.85
ze_r_switch_low: 0.25
fdg_low_adaptive: true
fdg_low_min: 0.45
fdg_low_max: 0.85
fdg_ema_beta: 0.45


# Mahiro+/Muse blend
muse_blend: true
muse_blend_strength: 0.24

# eps scale
eps_scale_enable: true
eps_scale: 0.0025

# CLIPSeg
clipseg_enable: true
# clipseg_text: hand, feet, face
clipseg_preview: 512
clipseg_threshold: 0.1
clipseg_blur: 11.5
clipseg_dilate: 5
clipseg_gain: 0.35
clipseg_blend: fuse
clipseg_reference_gate: true
clipseg_reference_threshold: 0.005

# polish
polish_enable: false
polish_keep_low: 0.40
polish_edge_lock: 0.20
polish_sigma: 1.0
polish_start_after: 1
polish_keep_low_ramp: 0.20

# mid-frequency stabilizer (hands/objects scale)
midfreq_enable: true
#midfreq_gain: 0.15
midfreq_gain: 0.28
midfreq_sigma_low: 0.85
midfreq_sigma_high: 2.40

# QSilk-AQClip-Lite (adaptive latent clipping)
aqclip_enable: true
aq_tile: 64
aq_stride: 8
aq_alpha: 2.0
aq_attn: true
aq_ema_beta: 0.8

# KV pruning (self-attention speedup)
kv_prune_enable: false
kv_keep: 0.85
kv_min_tokens: 128


[step3]
# core
# seed: 0
# control_after_generate: fixed
# steps: 16
# cfg: 7.0
# denoise: 0.55
# sampler_name: ddim
# scheduler: MGHybrid
iterations: 2
steps_delta: 4.00
cfg_delta: 0.03
denoise_delta: 0.0500

# Smart seed toggle (disable for this step)
smart_seed_enable: false

# toggles
apply_sharpen: false
apply_upscale: true
apply_ids: true
clip_clean: true
latent_compare: true

# latent buffer (internal)
# latent_buffer: true
# lb_inject: 0.25
# lb_ema: 0.75
# lb_every: 1
# lb_anchor_every: 4
# lb_masked: true
# lb_rebase_thresh: 0.10
# lb_rebase_rate: 0.25

# detail controls
#ids_strength: 0.25
ids_strength: 0.55
upscale_method: lanczos
scale_by: 1.20
scale_delta: 0.10
noise_offset: 0.10
threshold: 1.000
#0.135
sharpness_strength: 0.185
accumulation: fp32+fp32

# reference clean
reference_clean: true
reference_preview: 512
reference_threshold: 0.020
reference_cooldown: 2

# cfg schedule (internal)
#cfg_sched: off | cosine | warmup | u
# cfg_sched: warmup
# cfg_sched_min: 5.8
# cfg_sched_max: 7.8
# cfg_sched_gamma: 1.5
# cfg_sched_u_pow: 1.2


# guidance
guidance_mode: ZeResFDG
rescale_multiplier: 0.75
momentum_beta: 0.15
cfg_curve: 0.85
perp_damp: 0.80

# NAG
use_nag: true
nag_scale: 4.0
nag_tau: 2.50
nag_alpha: 0.25

# zero init
use_zero_init: false
zero_init_steps: 0

# FDG / ZE thresholds
fdg_low: 0.15
fdg_high: 1.15
fdg_sigma: 1.10
ze_res_zero_steps: 6
ze_adaptive: true
ze_r_switch_low: 0.25
ze_r_switch_high: 0.85
fdg_low_adaptive: true
fdg_low_min: 0.45
fdg_low_max: 0.85
fdg_ema_beta: 0.45


# Mahiro+/Muse blend
muse_blend: true
muse_blend_strength: 0.24

# eps scale
eps_scale_enable: true
eps_scale: 0.0025

# CLIPSeg
clipseg_enable: true
# clipseg_text: hand, feet, face
clipseg_preview: 512
clipseg_threshold: 0.1
clipseg_blur: 11.5
clipseg_dilate: 5
clipseg_gain: 0.35
clipseg_blend: fuse
clipseg_reference_gate: true
clipseg_reference_threshold: 0.005

# polish
polish_enable: false
polish_keep_low: 0.40
polish_edge_lock: 0.20
polish_sigma: 1.0
polish_start_after: 1
polish_keep_low_ramp: 0.20

# mid-frequency stabilizer (hands/objects scale)
midfreq_enable: true
#midfreq_gain: 0.15
midfreq_gain: 0.65
midfreq_sigma_low: 0.90
midfreq_sigma_high: 2.10

# QSilk-AQClip-Lite (adaptive latent clipping)
aqclip_enable: true
aq_tile: 64
aq_stride: 18
aq_alpha: 2.0
aq_attn: true
aq_ema_beta: 0.90

# KV pruning (self-attention speedup)
kv_prune_enable: false
kv_keep: 0.85
kv_min_tokens: 128

[step4]
# core
# seed: 0
# control_after_generate: fixed
# steps: 16
# cfg: 6
# #0.75
# denoise: 0.39
# sampler_name: ddim
# scheduler: MGHybrid
iterations: 2
steps_delta: 2.00
cfg_delta: 1.00
denoise_delta: 0.05

# Smart seed toggle (disable for this step)
smart_seed_enable: false

# toggles
apply_sharpen: true
apply_upscale: true
apply_ids: true
clip_clean: true
latent_compare: true

# latent buffer (internal)
# latent_buffer: true
# lb_inject: 0.30
# lb_ema: 0.75
# lb_every: 1
# lb_anchor_every: 6
# lb_masked: true
# lb_rebase_thresh: 0.10
# lb_rebase_rate: 0.25

# detail controls
ids_strength: 0.35
upscale_method: lanczos
# 1.55
scale_by: 1.50
scale_delta: 0.1
noise_offset: 0.0035
threshold: 1.000
sharpness_strength: 0.24
accumulation: fp32+fp32

# reference clean
reference_clean: true
reference_preview: 512
reference_threshold: 0.200
reference_cooldown: 2

# cfg schedule (internal)
#cfg_sched: off | cosine | warmup | u
# cfg_sched: warmup
# cfg_sched_min: 5.9
# cfg_sched_max: 7.0
# cfg_sched_gamma: 1.5
# cfg_sched_u_pow: 1.2


# guidance
guidance_mode: ZeResFDG
rescale_multiplier: 0.85
momentum_beta: 0.15
cfg_curve: 0.60
perp_damp: 0.85

# NAG
use_nag: true
nag_scale: 3.6
nag_tau: 2.50
nag_alpha: 0.25

# zero init
use_zero_init: false
zero_init_steps: 0

# FDG / ZE thresholds
fdg_low: 0.35
fdg_high: 0.90
fdg_sigma: 1.20
ze_res_zero_steps: 10
ze_adaptive: true
ze_r_switch_low: 0.25
ze_r_switch_high: 0.85
fdg_low_adaptive: true
fdg_low_min: 0.45
fdg_low_max: 0.85
fdg_ema_beta: 0.45


# Mahiro+/Muse blend
muse_blend: true
muse_blend_strength: 0.25

# eps scale
eps_scale_enable: true
eps_scale: 0.0025

# CLIPSeg
clipseg_enable: true
# clipseg_text: hand, feet, face
clipseg_preview: 512
clipseg_threshold: 0.1
clipseg_blur: 11.5
clipseg_dilate: 5
clipseg_gain: 0.35
clipseg_blend: fuse
clipseg_reference_gate: true
clipseg_reference_threshold: 0.005
# seg_use_cf_edges: true

# polish
polish_enable: false
polish_keep_low: 0.45
polish_edge_lock: 0.12
polish_sigma: 0.8
polish_start_after: 2
polish_keep_low_ramp: 0.12

# mid-frequency stabilizer (hands/objects scale)
midfreq_enable: true
midfreq_gain: 0.28
midfreq_sigma_low: 1.25
midfreq_sigma_high: 2.4


# QSilk-AQClip-Lite (adaptive latent clipping)
aqclip_enable: true
aq_tile: 128
#aq_stride: 8 
aq_stride: 15
#aq_alpha: 1.8
aq_alpha: 1.9
#aq_ema_beta: 0.85
aq_ema_beta: 0.90
aq_attn: true

# KV pruning (self-attention speedup)
kv_prune_enable: false
kv_keep: 0.95
kv_min_tokens: 256

